// Generated by CoffeeScript 1.7.1
var cookie, http, login, setOptions;

http = require('http');

cookie = null;

setOptions = function(content) {
  var headers, options;
  headers = {
    'Content-Type': 'application/json',
    'Content-Length': Buffer.byteLength(content),
    'Cookie': cookie,
    'X-Requested-With': 'XMLHttpRequest'
  };
  options = {
    hostname: 'greps.herokuapp.com',
    path: '/api/member/login',
    method: 'POST',
    headers: headers
  };
  return options;
};

login = function(fctnews) {
  var request, userString;
  userString = JSON.stringify(fctnews.user);
  request = http.request(setOptions(userString), function(res) {
    res.setEncoding('utf8');
    return res.on('data', function(data) {
      data = JSON.parse(data);
      if (data.response == null) {
        cookie = res.headers['set-cookie'];
        console.log('Logged in');
        return fctnews.queue();
      } else if (data.err.code === 304) {
        return console.log('Already logged in');
      } else {
        return console.log('Login failed');
      }
    });
  });
  request.on('error', function(e) {
    return console.log('Problem with request: ' + e.message);
  });
  request.write(userString);
  return request.end();
};

module.exports = {
  login: login,
  cookie: function() {
    return cookie;
  }
};
